<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PassPilot – Pass Tracker</title>
  <!-- Favicon: paper plane + check -->
  <link rel="icon" href='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 64 64"><rect rx="12" width="64" height="64" fill="%230a0a0a"/><path d="M12 32 L52 12 L40 52 L32 36 Z" fill="%23a3e635"/><path d="M22 44 l8-8" stroke="%23a3e635" stroke-width="4" stroke-linecap="round"/><path d="M20 40 l3 3 l6-6" stroke="%2300ff96" stroke-width="3" fill="none" stroke-linecap="round" stroke-linejoin="round"/></svg>' />
  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- React 18 + ReactDOM 18 + Babel -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <meta name="description" content="PassPilot – calculate your cohort score vs the 80% pass mark with transparent weights and what-if analysis." />
  <style>
    html, body { background: #f8fafc; }
    input[type=number]::-webkit-outer-spin-button,
    input[type=number]::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
    input[type=number] { -moz-appearance: textfield; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useEffect, useMemo, useState } = React;

    const STORAGE_KEY = 'passpilot-state-v1';

    const clamp = (x, lo, hi) => Math.min(hi, Math.max(lo, x));
    const num = (v, d=0) => { const n = Number(v); return Number.isFinite(n) ? n : d; };

    const Section = ({title,children}) => (
      <div className="bg-white rounded-2xl shadow p-5 border border-gray-100"> 
        <h2 className="text-lg font-semibold mb-3">{title}</h2>
        {children}
      </div>
    );

    const Stat = ({label, value, hint}) => (
      <div className="flex items-start justify-between py-2">
        <div className="text-gray-600">{label}</div>
        <div className="text-right">
          <div className="font-semibold">{value}</div>
          {hint && <div className="text-xs text-gray-400">{hint}</div>}
        </div>
      </div>
    );

    const ErrorText = ({children}) => children ? <p className="text-xs text-red-600 mt-1">{children}</p> : null;

    function App(){
      // quizzes: array of {status: 'scored' | 'na' | 'missed', score: string}
      const [quizzes, setQuizzes] = useState([{status:'scored', score:''}]);
      const [finalPct, setFinalPct] = useState('');
      const [tutorPct, setTutorPct] = useState('');
      const [capstonePct, setCapstonePct] = useState('');
      const [compliancePct, setCompliancePct] = useState('');

      const [remaining, setRemaining] = useState({ quizzes:false, final:true, tutor:true, capstone:true, compliance:true });

      // Load
      useEffect(()=>{
        try{
          const raw = localStorage.getItem(STORAGE_KEY);
          if(raw){
            const s = JSON.parse(raw);
            if(Array.isArray(s.quizzes)) setQuizzes(s.quizzes);
            setFinalPct(s.finalPct ?? '');
            setTutorPct(s.tutorPct ?? '');
            setCapstonePct(s.capstonePct ?? '');
            setCompliancePct(s.compliancePct ?? '');
            if(s.remaining) setRemaining(prev=>({...prev, ...s.remaining}));
          }
        }catch{}
      },[]);
      // Save
      useEffect(()=>{
        localStorage.setItem(STORAGE_KEY, JSON.stringify({quizzes,finalPct,tutorPct,capstonePct,compliancePct,remaining}));
      },[quizzes,finalPct,tutorPct,capstonePct,compliancePct,remaining]);

      // Validations
      const quizErrors = quizzes.map(q=>{
        if(q.status==='scored'){
          if(q.score==='') return 'Required';
          const n = num(q.score);
          if(!Number.isFinite(n)) return 'Must be a number';
          if(n<0 || n>20) return 'Enter 0–20';
        }
        return '';
      });
      const pctErr = (v)=>{
        if(v==='') return 'Required';
        const n = num(v);
        if(!Number.isFinite(n)) return 'Must be a number';
        if(n<0 || n>100) return 'Enter 0–100';
        return '';
      };
      const finalErr = pctErr(finalPct);
      const tutorErr = pctErr(tutorPct);
      const capstoneErr = pctErr(capstonePct);
      const complianceErr = pctErr(compliancePct);
      const anyInvalid = [finalErr,tutorErr,capstoneErr,complianceErr, ...quizErrors].some(Boolean);

      // Quiz math (exclude NA, include missed as 0)
      const {includedCount, quizAvgPct} = useMemo(()=>{
        const included = quizzes.filter(q=> q.status!=='na');
        const percents = included.map(q=> q.status==='missed' ? 0 : clamp(num(q.score)/20,0,1));
        const avg = percents.length ? (percents.reduce((a,b)=>a+b,0)/percents.length) : 0;
        return { includedCount: included.length, quizAvgPct: avg*100 };
      },[quizzes]);

      const quizPoints = (quizAvgPct/100)*15;
      const finalPoints = clamp(num(finalPct)/100,0,1)*25;
      const tutorPoints = clamp(num(tutorPct)/100,0,1)*20;
      const capstonePoints = clamp(num(capstonePct)/100,0,1)*35;
      const compliancePoints = clamp(num(compliancePct)/100,0,1)*5;
      const totalPoints = quizPoints + finalPoints + tutorPoints + capstonePoints + compliancePoints;
      const pass = totalPoints >= 80;

      const remainingCapacity = (remaining.quizzes?15:0)+(remaining.final?25:0)+(remaining.tutor?20:0)+(remaining.capstone?35:0)+(remaining.compliance?5:0);
      const pointsNeeded = Math.max(0, 80 - totalPoints);
      const requiredAvgOnRemaining = remainingCapacity>0 ? (pointsNeeded/remainingCapacity)*100 : 0;

      const addQuiz = ()=> setQuizzes([...quizzes, {status:'scored', score:''}]);
      const resetQuizzes = ()=> setQuizzes([{status:'scored', score:''}]);

      const sampleData = ()=>{
        setQuizzes([{status:'scored',score:'16'},{status:'scored',score:'18'},{status:'na',score:''},{status:'missed',score:''}]);
        setFinalPct('72'); setTutorPct('85'); setCapstonePct(''); setCompliancePct('90');
      };

      const Progress = ({value}) => (
        <div className="w-full bg-gray-200 rounded-full h-2.5">
          <div className="h-2.5 rounded-full" style={{width: `${clamp(value,0,100)}%`, background: pass ? '#16a34a' : '#f59e0b'}}></div>
        </div>
      );

      const LabeledPct = ({label, value, onChange, error}) => (
        <label className="block py-2">
          <div className="flex items-center justify-between">
            <span className="text-gray-600 mr-3">{label}</span>
            <span className="flex items-center">
              <input type="number" inputMode="decimal" step="0.1" value={value} onChange={(e)=> onChange(e.target.value)} className={`w-28 border rounded-lg px-3 py-2 text-right ${error? 'border-red-400 bg-red-50':'border-gray-300'}`} aria-invalid={!!error}/>
              <span className="ml-2 text-gray-500">%</span>
            </span>
          </div>
          <ErrorText>{error}</ErrorText>
        </label>
      );

      return (
        <div className="max-w-5xl mx-auto p-6">
          <header className="hidden sm:flex mb-6 items-center gap-3">
            <div className="w-10 h-10 rounded-xl bg-gray-900 grid place-items-center">
              <svg viewBox="0 0 64 64" className="w-7 h-7">
                <rect rx="12" width="64" height="64" fill="#a3e635"/>
                <path d="M12 32 L52 12 L40 52 L32 36 Z" fill="#0a0a0a"/>
                <path d="M22 44 l3 3 l6-6" stroke="#0a0a0a" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            </div>
            <div>
              <h1 className="text-2xl font-bold">PassPilot</h1>
              <p className="text-gray-600 -mt-0.5">
                Interactive pass tracker (target ≥ 80 pts) will be eligible to receive a certificate
              </p>
            </div>
          </header>

          <header className="flex sm:hidden mb-4 items-center gap-2">
            <div className="w-8 h-8 rounded-lg bg-gray-900 grid place-items-center">
              <svg viewBox="0 0 64 64" className="w-6 h-6">
                <rect rx="12" width="64" height="64" fill="#a3e635"/>
                <path d="M12 32 L52 12 L40 52 L32 36 Z" fill="#0a0a0a"/>
                <path d="M22 44 l3 3 l6-6" stroke="#0a0a0a" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
            </div>
            <div>
              <h1 className="text-lg font-bold">PassPilot</h1>
              <p className="text-gray-600 text-xs">
                Target ≥ 80 pts to earn a certificate
              </p>
            </div>
          </header>



          <div className="hidden sm:flex mb-4 gap-2 text-sm">
            <button 
              onClick={sampleData} 
              className="px-3 py-1.5 rounded-lg bg-white border">
              Load sample
            </button>

            <button 
              onClick={() => {
                localStorage.removeItem(STORAGE_KEY);
                window.location.reload();
              }} 
              className="px-3 py-1.5 rounded-lg bg-white border">
              Reset all
            </button>

            <a href="practice.html">
              <button className="px-3 py-1.5 rounded-lg bg-white border">
                Take Final Exam
              </button>
            </a>
          </div>


          <div className="flex sm:hidden mb-3 gap-2 text-xs">
            <button 
              onClick={sampleData} 
              className="px-2 py-1 rounded-md bg-white border">
              Sample
            </button>

            <button 
              onClick={() => {
                localStorage.removeItem(STORAGE_KEY);
                window.location.reload();
              }} 
              className="px-2 py-1 rounded-md bg-white border">
              Reset
            </button>

            <a href="practice.html">
              <button className="px-2 py-1 rounded-md bg-white border">
                Final Exam
              </button>
            </a>
          </div>



          <div className="grid md:grid-cols-2 gap-5">
            <Section title="Bi‑Weekly Quizzes (15 pts total)">
              <p className="text-sm text-gray-500 mb-2">Each row is a quiz. Choose status and enter <span className="font-medium">score out of 20</span> when applicable. <span className="font-medium">Not yet</span> is excluded from average; <span className="font-medium">Missed</span> counts as 0.</p>
              <div className="space-y-3">
                {quizzes.map((q, i) => (
                  <div key={i}>
                    <div className="flex flex-wrap items-center gap-2">
                      <select value={q.status} onChange={(e)=>{
                        const arr=[...quizzes]; arr[i] = {...arr[i], status:e.target.value}; setQuizzes(arr);
                      }} className="border rounded-lg px-3 py-2">
                        <option value="scored">Scored</option>
                        <option value="na">Not yet</option>
                        <option value="missed">Missed (0)</option>
                      </select>
                      <input type="number" inputMode="decimal" min="0" max="20" step="0.5" placeholder="score"
                        value={q.score}
                        onChange={(e)=>{ const arr=[...quizzes]; arr[i] = {...arr[i], score:e.target.value}; setQuizzes(arr); }}
                        disabled={q.status!=='scored'}
                        className={`w-28 border rounded-lg px-3 py-2 text-right ${q.status==='scored' && quizErrors[i] ? 'border-red-400 bg-red-50':'border-gray-300'} ${q.status!=='scored' ? 'opacity-60': ''}`}
                      />
                      <span className="text-gray-500">/ 20</span>
                      <button className="ml-auto text-sm text-red-600 hover:underline disabled:text-gray-300" onClick={()=> setQuizzes(quizzes.filter((_,idx)=>idx!==i))} disabled={quizzes.length===1}>Remove</button>
                    </div>
                    <ErrorText>{q.status==='scored' ? quizErrors[i] : ''}</ErrorText>
                  </div>
                ))}
              </div>
              <div className="flex gap-2 mt-3">
                <button onClick={()=> setQuizzes([...quizzes, {status:'scored', score:''}])} className="px-3 py-1.5 rounded-lg bg-gray-900 text-white text-sm">+ Add quiz</button>
                <button onClick={()=> resetQuizzes()} className="px-3 py-1.5 rounded-lg bg-white border text-sm">Reset quizzes</button>
              </div>
              <div className="mt-4 border-t pt-3">
                <Stat label="Quizzes counted" value={`${includedCount} of ${quizzes.length}`} hint="Not yet = excluded; Missed = 0" />
                <Stat label="Average quiz %" value={`${quizAvgPct.toFixed(1)}%`} />
                <Stat label="Points from quizzes" value={`${quizPoints.toFixed(2)} / 15`} />
              </div>
            </Section>

            <Section title="Final Exam (25 pts)">
              <LabeledPct label="Final exam %" value={finalPct} onChange={setFinalPct} error={finalErr} />
              <div className="mt-2 border-t pt-3"><Stat label="Points from final" value={`${finalPoints.toFixed(2)} / 25`} /></div>
            </Section>

            <Section title="Tutor Grading (20 pts)">
              <p className="text-sm text-gray-500 mb-2">Assignments + participation + questions.</p>
              <LabeledPct label="Tutor grading %" value={tutorPct} onChange={setTutorPct} error={tutorErr} />
              <div className="mt-2 border-t pt-3"><Stat label="Points from tutor grading" value={`${tutorPoints.toFixed(2)} / 20`} /></div>
            </Section>

            <Section title="Capstone Project (35 pts)">
              <LabeledPct label="Capstone %" value={capstonePct} onChange={setCapstonePct} error={capstoneErr} />
              <div className="mt-2 border-t pt-3"><Stat label="Points from capstone" value={`${capstonePoints.toFixed(2)} / 35`} /></div>
            </Section>

            <Section title="Compliance (5 pts)">
              <LabeledPct label="Compliance %" value={compliancePct} onChange={setCompliancePct} error={complianceErr} />
              <div className="mt-2 border-t pt-3"><Stat label="Points from compliance" value={`${compliancePoints.toFixed(2)} / 5`} /></div>
            </Section>

            <Section title="Progress & Requirements">
              <div className="grid grid-cols-1 gap-3">
                <div className="rounded-xl bg-gray-50 p-3 border text-sm space-y-2">
                  <div className="flex items-center justify-between"><span>Total points so far</span><span className="font-semibold">{totalPoints.toFixed(2)} / 100</span></div>
                  <Progress value={totalPoints} />
                  <div>
                    <span className={`inline-flex items-center px-2 py-1 rounded-lg text-xs ${ pass ? 'bg-green-100 text-green-700' : 'bg-yellow-100 text-yellow-800' }`}>
                      {pass ? 'On track: ≥ 80' : 'Below 80 — keep pushing'}
                    </span>
                  </div>
                </div>

                <div className="rounded-xl bg-white p-3 border">
                  <div className="text-sm font-medium mb-2">What do I still need?</div>
                  <Stat label="Points needed to reach 80" value={`${pointsNeeded.toFixed(2)}`} />
                  <div className="text-xs text-gray-500 mb-2">Select which components are still remaining:</div>
                  <div className="grid grid-cols-2 gap-2 text-sm">
                    {[
                      { key:'quizzes', label:'Quizzes (15)' },
                      { key:'final', label:'Final (25)' },
                      { key:'tutor', label:'Tutor (20)' },
                      { key:'capstone', label:'Capstone (35)' },
                      { key:'compliance', label:'Compliance (5)' },
                    ].map(opt => (
                      <label key={opt.key} className="flex items-center gap-2">
                        <input type="checkbox" checked={remaining[opt.key]} onChange={(e)=> setRemaining({ ...remaining, [opt.key]: e.target.checked }) } />
                        <span>{opt.label}</span>
                      </label>
                    ))}
                  </div>
                  <div className="mt-3 border-t pt-3">
                    <Stat label="Remaining capacity" value={`${remainingCapacity.toFixed(2)} pts`} hint="Max points still available for selected components" />
                    <Stat label="Required average across remaining" value={`${Math.min(100, Math.max(0, requiredAvgOnRemaining)).toFixed(1)}%`} hint="Score at least this average across the selected remaining items to reach 80." />
                  </div>
                </div>
              </div>
            </Section>
          </div>

          <footer className="mt-6 text-xs text-gray-400">PassPilot — Quizzes 15, Final 25, Tutor 20, Capstone 35, Compliance 5. Not‑yet quizzes are excluded; missed quizzes count as 0.</footer>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App/>);
  </script>
</body>
</html>
